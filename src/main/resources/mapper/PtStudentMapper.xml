<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rufeng.healthman.mapper.PtStudentMapper">
    <resultMap id="BaseResultMap" type="com.rufeng.healthman.pojo.DO.PtStudent">
        <id property="stuId" column="stu_id" jdbcType="VARCHAR"/>
        <result property="sid" column="sid" jdbcType="BIGINT"/>
        <result property="stuName" column="stu_name" jdbcType="VARCHAR"/>
        <result property="stuBirth" column="stu_birth" jdbcType="DATE"/>
        <result property="stuGender" column="stu_gender" jdbcType="CHAR"/>
        <result property="password" column="password" jdbcType="VARCHAR"/>
        <result property="avatar" column="avatar" jdbcType="VARCHAR"/>
        <result property="clsCode" column="cls_code" jdbcType="VARCHAR"/>
        <result property="stuCreated" column="stu_created" jdbcType="TIMESTAMP"/>
        <result property="stuModified" column="stu_modified" jdbcType="TIMESTAMP"/>
        <result property="stuLastLogin" column="stu_last_login" jdbcType="TIMESTAMP"/>
        <result property="stuDesp" column="stu_desp" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        stu_id,
        sid,
        stu_name,
        stu_birth,
        stu_gender,
        password,
        avatar,
        cls_code,
        stu_created,
        stu_modified,
        stu_last_login,
        stu_desp
    </sql>
    <sql id="Query">
        <if test="query.stuId != null">
            AND pt_student.stu_id = #{query.stuId}
        </if>

        <if test="query.clsCode != null">
            AND pt_student.cls_code = #{query.clsCode}
        </if>
        <if test="query.stuName != null">
            <bind value="'%' + query.stuName + '%'" name="stuName"/>
            AND pt_student.stu_name like #{stuName}
        </if>
        <if test="query.stuGender != null">
            AND pt_student.stu_gender = #{query.stuGender}
        </if>
    </sql>

    <sql id="OrderBy">
        <if test="query.order != null and query.field != null">
            ORDER BY ${query.field} ${query.order}
        </if>
    </sql>
    <insert id="insertBatch">
        INSERT INTO pt_student (stu_id, stu_name, stu_birth, stu_gender, cls_code) VALUES
        <foreach collection="items" item="item" separator=",">
            (#{item.stuId}, #{item.stuName}, #{item.stuBirth}, #{item.stuGender}, #{item.clsCode})
        </foreach>
    </insert>
    <update id="updateStudentByKey">
        UPDATE pt_student
        <set>
            <if test="stu.stuName != null">
                stu_name=#{stu.stuName},
            </if>
            <if test="stu.password != null">
                password=#{stu.password},
            </if>
            <if test="stu.avatar != null">
                avatar=#{stu.avatar},
            </if>
            <if test="stu.stuLastLogin != null">
                stu_last_login=#{stu.stuLastLogin},
            </if>
            <if test="stu.stuModified != null">
                stu_modified=#{stu.stuModified},
            </if>
            <if test="stu.stuDesp != null">
                stu_desp=#{stu.stuDesp},
            </if>
            <if test="stu.stuGender != null">
                stu_gender=#{stu.stuGender},
            </if>
            <if test="stu.stuBirth != null">
                stu_birth=#{stu.stuBirth},
            </if>
        </set>
        where stu_id = #{stu.stuId}
    </update>
    <select id="getStudent" resultType="com.rufeng.healthman.pojo.DO.PtStudent">
        SELECT
        <include refid="Base_Column_List"/>
        FROM pt_student
        WHERE stu_id = #{stuId}
    </select>
    <select id="pageStudentInfo" resultType="com.rufeng.healthman.pojo.DTO.ptstu.StudentInfo">
        SELECT sid,
               stu_id,
               stu_name,
               stu_birth,
               stu_gender,
               avatar,
               pt_class.cls_code AS cls_code,
               stu_created,
               stu_last_login,
               cls_name,
               stu_desp
        FROM pt_student
                     LEFT JOIN pt_class ON pt_student.cls_code = pt_class.cls_code
        <where>
            <include refid="Query"/>
        </where>
        <include refid="OrderBy"/>
    </select>
</mapper>
